# API-first development with OpenAPI
# This file will be used at compile time to generate Spring-MVC endpoint stubs using openapi-generator
openapi: '3.0.1'
info:
  title: 'The parking garage'
  version: 0.0.1
servers:
  - url: http://localhost:8080/api
    description: Development server
  - url: https://localhost:8080/api
    description: Development server with TLS Profile
paths:
  /api/register:
    post:
      summary: "POST api/register"
      operationId: "registerAccount"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ManagedUserVM"
        required: true
      responses:
        "201":
          description: "Created"
  /api/activate:
    get:
      summary: "GET api/activate"
      operationId: "activateAccount"
      parameters:
        - name: "key"
          in: "query"
          required: true
          schema:
            type: "string"
      responses:
        "200":
          description: "OK"
  /api/account:
    get:
      summary: "GET api/account"
      operationId: "getAccount"
      responses:
        "200":
          description: "OK"
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/AdminUserDTO"
    post:
      summary: "POST api/account"
      operationId: "saveAccount"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AdminUserDTO"
        required: true
      responses:
        "200":
          description: "OK"
  /api/account/change-password:
    post:
      summary: "POST api/account/change-password"
      operationId: "changePassword"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PasswordChangeDTO"
        required: true
      responses:
        "200":
          description: "OK"
  /api/account/reset-password/init:
    post:
      summary: "POST api/account/reset-password/init"
      operationId: "requestPasswordReset"
      requestBody:
        content:
          application/json:
            schema:
              type: "string"
        required: true
      responses:
        "200":
          description: "OK"
  /api/account/reset-password/finish:
    post:
      summary: "POST api/account/reset-password/finish"
      operationId: "finishPasswordReset"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/KeyAndPasswordVM"
        required: true
      responses:
        "200":
          description: "OK"

  /:
    get:
      summary: 'GET '
      operationId: 'home'
      responses:
        '200':
          description: 'OK'
          content:
            '*/*':
              schema:
                type: 'string'
components:
  responses:
    Problem:
      description: error occurred - see status code and problem object for more information.
      content:
        application/problem+json:
          schema:
            type: object
            properties:
              type:
                type: string
                format: uri
                description: |
                  An absolute URI that identifies the problem type.  When dereferenced,
                  it SHOULD provide human-readable documentation for the problem type
                  (e.g., using HTML).
                default: 'about:blank'
              title:
                type: string
                description: |
                  A short, summary of the problem type. Written in english and readable
                  for engineers (usually not suited for non technical stakeholders and
                  not localized); example: Service Unavailable
              status:
                type: integer
                format: int32
                description: |
                  The HTTP status code generated by the origin server for this occurrence
                  of the problem.
                minimum: 100
                maximum: 600
                exclusiveMaximum: true
                example: 503
              detail:
                type: string
                description: |
                  A human readable explanation specific to this occurrence of the
                  problem.
                example: Connection to database timed out
              instance:
                type: string
                format: uri
                description: |
                  An absolute URI that identifies the specific occurrence of the problem.
                  It may or may not yield further information if dereferenced.

  schemas:
    Instant:
      type: "object"
      properties: { }
    ManagedUserVM:
      type: "object"
      properties:
        password:
          type: "string"
        id:
          type: "integer"
          format: "int64"
        login:
          type: "string"
        firstName:
          type: "string"
        lastName:
          type: "string"
        email:
          type: "string"
        imageUrl:
          type: "string"
        activated:
          type: "boolean"
        createdBy:
          type: "string"
        createdDate:
          $ref: "#/components/schemas/Instant"
        lastModifiedBy:
          type: "string"
        lastModifiedDate:
          $ref: "#/components/schemas/Instant"
        authorities:
          type: "array"
          items:
            type: "string"
    AdminUserDTO:
      type: "object"
      properties:
        id:
          type: "integer"
          format: "int64"
        login:
          type: "string"
        firstName:
          type: "string"
        lastName:
          type: "string"
        email:
          type: "string"
        imageUrl:
          type: "string"
        activated:
          type: "boolean"
        createdBy:
          type: "string"
        createdDate:
          $ref: "#/components/schemas/Instant"
        lastModifiedBy:
          type: "string"
        lastModifiedDate:
          $ref: "#/components/schemas/Instant"
        authorities:
          type: "array"
          items:
            type: "string"
    PasswordChangeDTO:
      type: "object"
      properties:
        currentPassword:
          type: "string"
        newPassword:
          type: "string"
    KeyAndPasswordVM:
      type: "object"
      properties:
        key:
          type: "string"
        newPassword:
          type: "string"

  securitySchemes:
    jwt:
      type: http
      description: JWT Authentication
      scheme: bearer
      bearerFormat: JWT
    basic:
      type: http
      description: Basic Authentication
      scheme: basic
security:
  - jwt: []
  - basic: []
